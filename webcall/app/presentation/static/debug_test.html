<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Panel Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .debug-status { background: rgba(255,255,255,0.1); padding: 10px; margin: 10px 0; border-radius: 5px; }
        .logs { background: #000; padding: 10px; height: 200px; overflow-y: auto; border: 1px solid #333; }
        .debug-msg { margin: 2px 0; padding: 3px; }
        .debug-msg.incoming { background: rgba(0,255,0,0.2); }
        .debug-msg.outgoing { background: rgba(255,0,0,0.2); }
        .debug-msg.call-event { background: rgba(0,0,255,0.2); }
        button { margin: 5px; padding: 8px 15px; background: #333; color: #fff; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #555; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    </style>
</head>
<body>
    <h1>üîß Debug Panel Test</h1>
    
    <div>
        <button onclick="testFriendsMessage()">–¢–µ—Å—Ç Friends Message</button>
        <button onclick="testCallEvent()">–¢–µ—Å—Ç Call Event</button>
        <button onclick="testStateChange()">–¢–µ—Å—Ç State Change</button>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <div class="grid">
        <div>
            <h3>Friends WebSocket Status</h3>
            <div class="debug-status">
                <div>–°—Ç–∞—Ç—É—Å: <span id="friendsWsState">OPEN</span></div>
                <div>–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—É—á–µ–Ω–æ: <span id="friendsWsMessageCount">0</span></div>
                <div>–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: <span id="friendsWsLastMessage">-</span></div>
                <div>–†–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤: <span id="friendsWsReconnects">0</span></div>
            </div>
        </div>
        <div>
            <h3>Call State</h3>
            <div class="debug-status">
                <div>–§–∞–∑–∞: <span id="callPhase">idle</span></div>
                <div>–¢–∏–ø: <span id="callType">-</span></div>
                <div>–î—Ä—É–≥: <span id="callFriendId">-</span></div>
                <div>Room ID: <span id="callRoomId">-</span></div>
            </div>
        </div>
    </div>

    <h3>Friends WebSocket Messages</h3>
    <div id="debugFriendsMessages" class="logs"></div>

    <h3>Call Debug Log</h3>
    <div id="debugCallLog" class="logs"></div>

    <script>
        // –≠–º—É–ª—è—Ü–∏—è appState
        window.appState = {
            callPhase: 'idle',
            callType: '',
            callFriendId: '',
            callRoomId: '',
            friendsWsMessageCount: 0,
            lastFriendsMessage: null
        };

        // –ó–∞–≥—Ä—É–∂–∞–µ–º debug panel
        const script = document.createElement('script');
        script.src = '/static/js/debug_panel.js';
        script.onload = () => {
            console.log('Debug panel loaded');
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª—å
            window.debugPanel = new DebugPanel();
        };
        document.head.appendChild(script);

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function testFriendsMessage() {
            if (window.debugPanel) {
                const testMsg = {
                    type: 'call_invite',
                    fromUserId: 'user123',
                    toUserId: 'user456',
                    roomId: 'room789',
                    fromUsername: 'TestUser'
                };
                window.debugPanel.logFriendsMessage('call_invite', testMsg, 'incoming');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫
                window.appState.friendsWsMessageCount++;
                window.appState.lastFriendsMessage = testMsg;
            }
        }

        function testCallEvent() {
            if (window.debugPanel) {
                window.debugPanel.logCallEvent('CALL_INVITE', {
                    roomId: 'room789',
                    from: 'user123',
                    to: 'user456',
                    phase: 'incoming_invite'
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
                window.appState.callPhase = 'incoming_invite';
                window.appState.callType = 'incoming';
                window.appState.callFriendId = 'user123';
                window.appState.callRoomId = 'room789';
            }
        }

        function testStateChange() {
            if (window.debugPanel) {
                window.debugPanel.logCallEvent('STATE_CHANGE', {
                    from: 'idle',
                    to: 'outgoing_invite',
                    roomId: 'room999',
                    otherUserId: 'user888'
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                window.appState.callPhase = 'outgoing_invite';
                window.appState.callType = 'outgoing';
                window.appState.callFriendId = 'user888';
                window.appState.callRoomId = 'room999';
            }
        }

        function clearLogs() {
            if (window.debugPanel) {
                window.debugPanel.clearLogs();
            }
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Å—Ä–∞–∑—É
        setTimeout(() => {
            if (window.debugPanel) {
                window.debugPanel.isVisible = true;
                document.getElementById('debugContent').style.display = 'block';
            }
        }, 1000);
    </script>
</body>
</html>